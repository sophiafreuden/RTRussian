---
title: "RTRussian"
author: "Sophia Freuden"
date: "1/13/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
library(tm)
library(SentimentAnalysis)
library(syuzhet)
library(SnowballC)
library(wordcloud)
library(RColorBrewer)
library(RCurl)
library(corpus)
library(textclean)
library(lubridate)
library(gt)
library(tidyverse)
```

```{r}
col_types = cols(
  date = col_character(),
  title = col_character(),
  content = col_character(),
  URL = col_character()
)

data <- read_delim("RT_rus_test.txt", delim = "*", col_types = col_types)

data$date[4] <- "4 3 2019"

data <- data %>%
  mutate(date = dmy(date))

data <- data[-4,]
```

```{r}
view(data)
```

```{r}
corpus <- SimpleCorpus(VectorSource(data$content))
```

```{r}
corpus <- tm_map(corpus, stripWhitespace)

corpus <- tm_map(corpus, content_transformer(tolower))

corpus <- tm_map(corpus, removeNumbers)

corpus <- tm_map(corpus, removePunctuation)

corpus <- tm_map(corpus, removeWords, stopwords("russian"))
```

```{r}
nonstem.corpus <- corpus
# corpus <- tm_map(corpus, stemDocument)
# Not convinced that this stems anything... this may be an issue going forward.

view(nonstem.corpus)
```

```{r}
nDTM <- DocumentTermMatrix(nonstem.corpus)
#  DTM <- DocumentTermMatrix(corpus)

view(nDTM)
```

```{r}
sums <- as.data.frame(colSums(as.matrix(nDTM)))
sums <- rownames_to_column(sums) 
colnames(sums) <- c("term", "count")
sums <- arrange(sums, desc(count))
head <- sums[1:75,]

sums2 <- as.data.frame(as.matrix(nDTM))
# sums2d <- as.data.frame(as.matrix(DTM))
```

```{r}
sums2$ArtDate <- data$date
# sums2d$ArtDate <- data$date

# view(sums2)

# sums2R <- sums2
# sums2Rd <- sums2d
```

```{r}
names <- colnames(sums2)

names <- text_tokens(names, stemmer = "ru")

names2 <- sapply(names, `[[`, 1)

names3 <- unlist(names2, use.names=FALSE)

colnames(sums2) <- names3

view(sums2)
```

```{r}
sums2 %>%
  group_by(ArtDate) %>% 
  summarise(Frequency = sum(её)) %>%
  ggplot(aes(x = ArtDate, y = Frequency)) +
  geom_point() +
  geom_smooth(method = 'loess') +
  labs(
    title = "Term Frequency Per Article Over Time",
    subtitle = "Term: 'её', RT Search Term: 'TEST'",
    x = "Date",
    y = "Frequency",
    # All terms in the Russian version are stemmed.
    caption = "Stemmed."
  ) +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ggsave("plot1.png", width = 10)
```



